<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SYMMETRICAL HOLO WHEEL</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* ==== CYBERPUNK BASE STYLES ==== */
    body {
      background: #000;
      overflow: hidden;
      height: 100vh;
      font-family: 'Courier New', monospace;
      perspective: 1000px;
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 0;
    }

    /* ==== FUTURISTIC BACKGROUND ==== */
    .cyber-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      background: 
        radial-gradient(circle at 20% 30%, rgba(0, 100, 255, 0.1) 0%, transparent 40%),
        radial-gradient(circle at 80% 70%, rgba(138, 43, 226, 0.1) 0%, transparent 40%),
        linear-gradient(to bottom, #000000, #0a0a20);
    }

    .grid-lines {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        linear-gradient(rgba(0, 191, 255, 0.1) 1px, transparent 1px),
        linear-gradient(90deg, rgba(138, 43, 226, 0.1) 1px, transparent 1px);
      background-size: 50px 50px;
    }

    .scanlines {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: repeating-linear-gradient(
        0deg,
        rgba(0, 0, 0, 0.15),
        rgba(0, 0, 0, 0.15) 1px,
        transparent 1px,
        transparent 2px
      );
    }

    /* ==== HOLO WHEEL ==== */
    .holo-container {
      position: relative;
      width: 600px;
      height: 600px;
      display: flex;
      justify-content: center;
      align-items: center;
      transform-style: preserve-3d;
    }

    .holo-wheel {
      position: relative;
      width: 500px;
      height: 500px;
      border-radius: 50%;
      border: 2px solid rgba(0, 191, 255, 0.5);
      box-shadow: 
        0 0 60px rgba(0, 191, 255, 0.3),
        inset 0 0 40px rgba(138, 43, 226, 0.3);
      display: flex;
      justify-content: center;
      align-items: center;
      transform-style: preserve-3d;
      transition: transform 0.1s ease-out;
      background: rgba(10, 10, 30, 0.3);
      backdrop-filter: blur(10px);
    }

    .center-circle {
      position: absolute;
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: rgba(0, 191, 255, 0.1);
      border: 2px solid rgba(0, 191, 255, 0.3);
      box-shadow: 
        inset 0 0 20px rgba(0, 191, 255, 0.2),
        0 0 30px rgba(138, 43, 226, 0.3);
    }

    /* ==== WHEEL SEGMENTS ==== */
    .wheel-segment {
      position: absolute;
      width: 140px;
      height: 140px;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      font-size: 16px;
      color: #00bfff;
      text-shadow: 0 0 10px #00bfff;
      cursor: pointer;
      transition: all 0.3s ease;
      transform-origin: center;
      background: rgba(20, 20, 50, 0.3);
      backdrop-filter: blur(5px);
      border: 1px solid rgba(0, 191, 255, 0.3);
      box-shadow: 0 0 15px rgba(0, 191, 255, 0.2);
    }

    .wheel-segment:hover {
      background: rgba(0, 191, 255, 0.2);
      color: #ff00ff;
      text-shadow: 0 0 15px #ff00ff, 0 0 30px #ff00ff;
      transform: scale(1.3) translateZ(30px);
      border-color: #ff00ff;
      box-shadow: 0 0 30px #ff00ff;
    }

    /* UPDATED SEGMENT POSITIONS FOR SYMMETRY */
    .wheel-segment:nth-child(1) { transform: rotate(0deg) translateY(-230px); }   /* VOICE MODE */
    .wheel-segment:nth-child(2) { transform: rotate(60deg) translateY(-230px); }  /* NEON SHIFT */
    .wheel-segment:nth-child(3) { transform: rotate(120deg) translateY(-230px); }  /* ABOUT ME */
    .wheel-segment:nth-child(4) { transform: rotate(180deg) translateY(-230px); }  /* EXIT */
    .wheel-segment:nth-child(5) { transform: rotate(240deg) translateY(-230px); } /* FACE MODE */
    .wheel-segment:nth-child(6) { transform: rotate(300deg) translateY(-230px); }  /* NEW CHAT */

    .emoji {
      font-size: 36px;
      margin-bottom: 10px;
      filter: drop-shadow(0 0 5px currentColor);
    }

    /* ==== PULSING GLOW EFFECT ==== */
    @keyframes pulse-glow {
      0%, 100% { opacity: 0.8; }
      50% { opacity: 1; }
    }

    .pulse {
      animation: pulse-glow 2s infinite ease-in-out;
    }

    /* Exit Modal Styles */
    #exitModal {
      z-index: 1000;
    }
    
    @keyframes modal-glow {
      0%, 100% { box-shadow: 0 0 30px rgba(0,255,255,0.2); }
      50% { box-shadow: 0 0 50px rgba(0,255,255,0.5); }
    }
    
    .modal-content {
      animation: modal-glow 2s infinite ease-in-out;
    }

    /* Loading Indicator */
    .loading-indicator {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      z-index: 2000;
      color: #00bfff;
      font-size: 1.5rem;
      text-shadow: 0 0 10px #00bfff;
      backdrop-filter: blur(5px);
    }

    .loading-spinner {
      border: 5px solid rgba(0, 191, 255, 0.3);
      border-top: 5px solid #00bfff;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <!-- Futuristic Cyberpunk Background -->
  <div class="cyber-bg">
    <div class="grid-lines"></div>
    <div class="scanlines"></div>
  </div>

  <!-- Loading Indicator (Hidden by default) -->
  <div id="loadingIndicator" class="loading-indicator hidden">
    <div class="loading-spinner"></div>
    <p id="loadingText">Initializing system...</p>
  </div>

  <!-- Exit Confirmation Modal -->
  <div id="exitModal" class="fixed inset-0 flex items-center justify-center bg-black/60 backdrop-blur-sm z-50 hidden">
    <div class="p-6 rounded-xl bg-[#0a0a15] border border-cyan-500 modal-content flex flex-col items-center relative">
      <h2 class="text-cyan-400 text-xl font-bold mb-2 text-center">Leaving already, love? üíî</h2>
      <p class="text-cyan-200 mb-6 text-center">Stay a little longer with me?</p>
      <div class="flex gap-4">
        <button id="confirmExit" class="px-5 py-2 border border-pink-400 text-pink-300 hover:bg-pink-700/30 rounded transition-all">Yes, exit</button>
        <button id="cancelExit" class="px-5 py-2 border border-cyan-400 text-cyan-300 hover:bg-cyan-700/30 rounded transition-all">No, stay</button>
      </div>
    </div>
  </div>

  <!-- Main Wheel Container -->
  <div class="holo-container">
    <div class="holo-wheel" id="holoWheel">
      <div class="center-circle pulse"></div>
      
      <!-- Wheel Segments -->
      <div class="wheel-segment" data-option="voice-mode">
        <span class="emoji">üé§</span>
        <span>VOICE MODE</span>
      </div>
      <div class="wheel-segment" data-option="neon-shift">
        <span class="emoji">üåà</span>
        <span>NEON SHIFT</span>
      </div>
      <div class="wheel-segment" data-option="about-me">
        <span class="emoji">üë§</span>
        <span>ABOUT ME</span>
      </div>
      <div class="wheel-segment" data-option="exit">
        <span class="emoji">üö™</span>
        <span>EXIT</span>
      </div>
      <div class="wheel-segment" data-option="face-mode">
        <span class="emoji">üëÅÔ∏è</span>
        <span>FACE MODE</span>
      </div>
      <div class="wheel-segment" data-option="new-chat">
        <span class="emoji">üí¨</span>
        <span>NEW CHAT</span>
      </div>
    </div>
  </div>

  <!-- JavaScript -->
  <script>
    // Set default skins if not already set
    if (!localStorage.getItem("lastChatSkin")) {
      localStorage.setItem("lastChatSkin", "chatpage");
    }
    if (!localStorage.getItem("lastVoiceSkin")) {
      localStorage.setItem("lastVoiceSkin", "voice_mode.html");
    }
    if (!localStorage.getItem("lastFaceSkin")) {
      localStorage.setItem("lastFaceSkin", "face_mode.html");
    }

    const wheel = document.getElementById('holoWheel');
    const loadingIndicator = document.getElementById('loadingIndicator');
    const loadingText = document.getElementById('loadingText');
    let isDragging = false;
    let startAngle = 0;
    let currentAngle = 0;
    let lastX = 0;
    let lastY = 0;
    let velocity = 0;
    let friction = 0.95;
    let animationId = null;

    // Mouse down: Start dragging
    wheel.addEventListener('mousedown', (e) => {
      isDragging = true;
      startAngle = getAngle(e.clientX, e.clientY);
      lastX = e.clientX;
      lastY = e.clientY;
      cancelAnimationFrame(animationId);
    });

    // Mouse move: Rotate wheel
    document.addEventListener('mousemove', (e) => {
      if (!isDragging) return;
      
      const angle = getAngle(e.clientX, e.clientY);
      const delta = angle - startAngle;
      currentAngle += delta;
      wheel.style.transform = `rotate(${currentAngle}deg)`;
      startAngle = angle;
      
      // Calculate velocity for inertia
      velocity = (e.clientX - lastX) * 0.2;
      lastX = e.clientX;
      lastY = e.clientY;
    });

    // Mouse up: Stop dragging and apply inertia
    document.addEventListener('mouseup', () => {
      isDragging = false;
      if (Math.abs(velocity) > 0.5) {
        animateInertia();
      }
    });

    // Animate inertia after mouse release
    function animateInertia() {
      currentAngle += velocity;
      wheel.style.transform = `rotate(${currentAngle}deg)`;
      velocity *= friction;
      
      if (Math.abs(velocity) > 0.5) {
        animationId = requestAnimationFrame(animateInertia);
      }
    }

    // Calculate angle between mouse and wheel center
    function getAngle(x, y) {
      const rect = wheel.getBoundingClientRect();
      const centerX = rect.left + rect.width / 2;
      const centerY = rect.top + rect.height / 2;
      return Math.atan2(y - centerY, x - centerX) * 180 / Math.PI;
    }

    // Click actions for segments
    document.querySelectorAll('.wheel-segment').forEach(segment => {
      segment.addEventListener('click', () => {
        const option = segment.getAttribute('data-option');

        const lastChat = localStorage.getItem("lastChatSkin") || 'chatpage';
        const lastVoice = localStorage.getItem("lastVoiceSkin") || 'voice-ui';
        const lastFace = localStorage.getItem("lastFaceSkin") || 'face-ui';

        if (option === 'new-chat') {
          window.location.href = `/${lastChat}`;
        } 
        else if (option === 'about-me') {
          window.location.href = '/aboutme';
        }
        else if (option === 'exit') {
          document.getElementById('exitModal').classList.remove('hidden');
        }
        else if (option === 'neon-shift') {
          window.location.href = '/selector';
        }
        else if (option === 'voice-mode') {
          showLoading('Initializing Voice Mode...');
          fetch('/voice-mode')
            .then(() => window.location.href = `/${lastVoice}`);
        }
        else if (option === 'face-mode') {
          showLoading('Initializing Face Mode...');
          fetch('/face-mode')
            .then(() => window.location.href = `/${lastFace}`)
            .catch(err => {
              console.error("Face mode failed", err);
              hideLoading();
            });
        }
      });
    });

    // Loading indicator functions
    function showLoading(message) {
      loadingText.textContent = message;
      loadingIndicator.classList.remove('hidden');
    }

    function hideLoading() {
      loadingIndicator.classList.add('hidden');
    }

    // Exit modal buttons
    document.getElementById('confirmExit').addEventListener('click', () => {
      showLoading('Closing system...');
      fetch('/exit', { method: 'POST' })
        .then(() => console.log("Exit requested"))
        .catch(err => {
          console.error("Exit failed", err);
          hideLoading();
        });
    });
    
    document.getElementById('cancelExit').addEventListener('click', () => {
      document.getElementById('exitModal').classList.add('hidden');
    });

    // Tilt effect on mouse move
    document.addEventListener('mousemove', (e) => {
      if (isDragging) return;
      
      const x = (window.innerWidth / 2 - e.clientX) / 30;
      const y = (window.innerHeight / 2 - e.clientY) / 30;
      document.querySelector('.holo-container').style.transform = 
        `perspective(1000px) rotateX(${y}deg) rotateY(${-x}deg)`;
    });
  </script>
</body>
</html>